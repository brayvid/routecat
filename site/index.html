<!--
Title: ACRoute v1.1 
Usage: (c) 2020 Blake Rayvid. Non-commercial use only.
Author: Blake Rayvid (https//github.com/brayvid)  */
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>

        ACRoute

    </title>

    <!-- Bootstrap CSS 4.3.1 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">


    <!-- Local stylesheet CSS -->
    <style>
        html {
            position: relative;
            min-height: 100%;
            margin: 0;
        }

        body {
            margin-bottom: 60px;
            /* Margin bottom by footer height */
        }

        .navbar {
            height: 100px;
        }

        .container {
            width: 100%;
            white-space: nowrap;
            padding-top: 20px;
        }

        #store {
            font-size: 0.9em;
        }

        .form-row {
            margin: 8px;
        }

        .buttonrow {
            padding: 12px;
            text-align: center;
        }

        .fieldbuttonrow {
            text-align: center;
        }

        #display {
            padding: 16px;
        }

        .btn {
            width: 40%;
        }

        .uploadButton {
            background-color: #2d096b;
            border-color: #2d096b;
            color: white;
        }

        #tablebody {
            padding: 10px;
        }

        #assign {
            background-color: #2d096b;
            border-color: #2d096b;
        }

        #displayTable {
            margin: 0;
        }

        .footer {
            position: absolute;
            bottom: 10px;
            width: 100%;
            height: 60px;
            line-height: 60px;
        }

        #footertext {
            text-align: center;
        }

        #googlelogo {
            display: inline;
            /* the default for span */
            height: 1.3em;
        }

        #map {
            margin: 0;
            padding: 0;
            height: 400px;
            width: auto;
            overflow: visible;
        }

        #fields {
            width: 100%;
        }

        .navbar-brand {
            text-align: center;
        }

        /* .upload {} */
    </style>

    <!-- JQuery JS 3.5.1 -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <!-- Bootstrap JS 4.3.1 -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
    </script>

    <!-- Preferences JS -->
    <script src="src/prefs.js"></script>

    <!-- Main program JS -->
    <script src="src/acroute.js"></script>

    <!-- Google Maps JS API -->
    <script type="text/javascript"> 
        var JSLink = `https://maps.googleapis.com/maps/api/js?key=${process.env.API_KEY}&callback=googleReady`;
        var JSElement = document.createElement('script');
        JSElement.src = JSLink;
        JSElement.onload = OnceLoaded;
        document.getElementsByTagName('head')[0].appendChild(JSElement);
    
        function OnceLoaded() {
            // Once loaded.. load other JS or CSS or call objects of version.js
        }
    </script>
</head>

<body>
    <!-- Title bar -->
    <nav class="navbar-nav nav-fill w-100">
        <h6 class="navbar-brand">

            ACRoute v1.2

            <br>

            <!-- <input id="uploader" type="file" accept="image/*" capture="camera" class="uploadButton"> -->
            <input id="uploader" class="uploadButton" type="file" accept="image/*">

            <form id="start" class=".w-auto">
            </form>

        </h6>

        <!-- <img class="logo" src="img/logo.png" width="50" height="50"> -->
    </nav>

    <main role="main" class="container">
        <!-- Area for displaying table or status string -->
        <div id="display" class="collapse">
            <div id="tbl"></div>
            <div id="map"></div>
        </div>
        <!-- Buttons to add/remove field rows -->
        <div class="fieldbuttonrow">
            <button class="btn btn-default" onclick="removeField()">

                Remove row

            </button>
            <button class="btn btn-default" onclick="addField()">

                Add row

            </button>

        </div>
        <!-- Area for field grid -->
        <form id="fields">
        </form>


        <!-- Assign button -->
        <div class="buttonrow">
            <button id="assign" class="btn btn-primary" onclick="requestMatrix()">

                Route

            </button>
        </div>
    </main>

    <footer class="footer">
        <div class="container" id="footertext">
            <span>
                <a href="https://cloud.google.com/"><img id="googlelogo" src="img/cloud.png"></img></a>
            </span>
        </div>
    </footer>

    <script>
        $(document).ready(function () {
            makeEndptFields();
            // Set initial number of input rows
            for (let r = 0; r < initialInputRows; r++) {
                addField();
            }

            // "Assign" button shows display
            $("#assign").click(function () {
                $(".collapse").collapse('show');
            });

            // var GCVUrl =
            //     'https://vision.googleapis.com/v1/images:annotate?key=[KEY_HERE]';
            // var input = document.querySelector('input[type=file]');
            // var fileReader = new FileReader();

            // input.onchange = function (event) {

            //     var file = event.target.files[0];

            //     fileReader.onload = function (fileLoadedEvent) {
            //         var GCVRequest = {
            //             requests: [{
            //                 image: {
            //                     content: fileLoadedEvent.target.result.split(',')[1]
            //                     // must discard `data:image/png;base64,`
            //                 },
            //                 features: [{
            //                     type: 'DOCUMENT_TEXT_DETECTION'
            //                 }]
            //             }]
            //         };

            //         $.ajax({
            //             type: 'POST',
            //             url: GCVUrl,
            //             dataType: 'json',
            //             contentType: 'application/json',
            //             data: JSON.stringify(GCVRequest),
            //             success: function (data) {
            //                 var texts;
            //                 if (texts = data.responses[0].textAnnotations) {
            //                     ocrText = texts[0].description.split("\n");
            //                     i = 0; // Current read
            //                     j = 0; // Current write
            //                     while (i <= ocrText.length) {
            //                         if (ocrText[i] != "" && ocrText[i] != "\n") {
            //                             document.getElementById('a' + (j + 1)).value =
            //                                 ocrText[i];
            //                             j++;
            //                         }
            //                         i++;
            //                     }
            //                 } else {
            //                     alert('No text was recognized');
            //                 }
            //             },
            //             error: function (jqXhr, textStatus, error) {
            //                 alert('XHR error: ' + jqXhr.responseJSON.error.message);
            //             }
            //         });

            //     };

            //     fileReader.readAsDataURL(file);

            // };

            // myInput.addEventListener('change', recognize);

        });
    </script>
</body>

</html>
